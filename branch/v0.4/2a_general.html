<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>General Concept | ThingSet Protocol Specification</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="apple-touch-icon" sizes="180x180" href="/thingset/branch/v0.4/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/thingset/branch/v0.4/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/thingset/branch/v0.4/favicons/favicon-16x16.png">
    <link rel="manifest" href="/thingset/branch/v0.4/favicons/site.webmanifest">
    <link rel="mask-icon" href="/thingset/branch/v0.4/favicons/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="shortcut icon" href="/thingset/branch/v0.4/favicons/favicon.ico">
    <meta name="description" content="The ThingSet protocol provides a consistent, standardized way to configure, monitor and control ressource-constrained devices via different communication interfaces like Serial, LoRa, USB, Bluetooth or CAN.">
    <meta name="msapplication-TileColor" content="#2b5797">
    <meta name="msapplication-config" content="/favicons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    
    <link rel="preload" href="/thingset/branch/v0.4/assets/css/0.styles.c027ba64.css" as="style"><link rel="preload" href="/thingset/branch/v0.4/assets/js/app.7e1b989c.js" as="script"><link rel="preload" href="/thingset/branch/v0.4/assets/js/2.d1779d51.js" as="script"><link rel="preload" href="/thingset/branch/v0.4/assets/js/3.b5a90050.js" as="script"><link rel="preload" href="/thingset/branch/v0.4/assets/js/9.1ab050b2.js" as="script"><link rel="prefetch" href="/thingset/branch/v0.4/assets/js/10.68018d76.js"><link rel="prefetch" href="/thingset/branch/v0.4/assets/js/11.c1808bb4.js"><link rel="prefetch" href="/thingset/branch/v0.4/assets/js/12.98ecfbf7.js"><link rel="prefetch" href="/thingset/branch/v0.4/assets/js/13.a3811688.js"><link rel="prefetch" href="/thingset/branch/v0.4/assets/js/14.393e3bc7.js"><link rel="prefetch" href="/thingset/branch/v0.4/assets/js/15.26149b18.js"><link rel="prefetch" href="/thingset/branch/v0.4/assets/js/16.f22c36ee.js"><link rel="prefetch" href="/thingset/branch/v0.4/assets/js/17.76ae0be1.js"><link rel="prefetch" href="/thingset/branch/v0.4/assets/js/18.6145aa14.js"><link rel="prefetch" href="/thingset/branch/v0.4/assets/js/19.4b199fc0.js"><link rel="prefetch" href="/thingset/branch/v0.4/assets/js/20.fc68cf28.js"><link rel="prefetch" href="/thingset/branch/v0.4/assets/js/21.aed46329.js"><link rel="prefetch" href="/thingset/branch/v0.4/assets/js/22.6464eb63.js"><link rel="prefetch" href="/thingset/branch/v0.4/assets/js/23.8a8cf15c.js"><link rel="prefetch" href="/thingset/branch/v0.4/assets/js/24.4d4e7e7e.js"><link rel="prefetch" href="/thingset/branch/v0.4/assets/js/25.36679e33.js"><link rel="prefetch" href="/thingset/branch/v0.4/assets/js/26.151e28b0.js"><link rel="prefetch" href="/thingset/branch/v0.4/assets/js/27.7d1c34c1.js"><link rel="prefetch" href="/thingset/branch/v0.4/assets/js/28.332ba0d7.js"><link rel="prefetch" href="/thingset/branch/v0.4/assets/js/29.b035c8c6.js"><link rel="prefetch" href="/thingset/branch/v0.4/assets/js/30.01b825cc.js"><link rel="prefetch" href="/thingset/branch/v0.4/assets/js/31.30a3565f.js"><link rel="prefetch" href="/thingset/branch/v0.4/assets/js/32.2d4c55b6.js"><link rel="prefetch" href="/thingset/branch/v0.4/assets/js/33.85c3435c.js"><link rel="prefetch" href="/thingset/branch/v0.4/assets/js/34.6ee775b0.js"><link rel="prefetch" href="/thingset/branch/v0.4/assets/js/35.365389ef.js"><link rel="prefetch" href="/thingset/branch/v0.4/assets/js/36.73841804.js"><link rel="prefetch" href="/thingset/branch/v0.4/assets/js/37.24bbb752.js"><link rel="prefetch" href="/thingset/branch/v0.4/assets/js/38.4d7f649a.js"><link rel="prefetch" href="/thingset/branch/v0.4/assets/js/39.f122f195.js"><link rel="prefetch" href="/thingset/branch/v0.4/assets/js/4.b50bddb9.js"><link rel="prefetch" href="/thingset/branch/v0.4/assets/js/40.8469c376.js"><link rel="prefetch" href="/thingset/branch/v0.4/assets/js/41.ae658311.js"><link rel="prefetch" href="/thingset/branch/v0.4/assets/js/42.265302ce.js"><link rel="prefetch" href="/thingset/branch/v0.4/assets/js/43.cd87fd09.js"><link rel="prefetch" href="/thingset/branch/v0.4/assets/js/44.758d214c.js"><link rel="prefetch" href="/thingset/branch/v0.4/assets/js/5.dfd9db3d.js"><link rel="prefetch" href="/thingset/branch/v0.4/assets/js/6.c96e07da.js"><link rel="prefetch" href="/thingset/branch/v0.4/assets/js/7.a2e8fd4a.js"><link rel="prefetch" href="/thingset/branch/v0.4/assets/js/8.baf0f7d8.js">
    <link rel="stylesheet" href="/thingset/branch/v0.4/assets/css/0.styles.c027ba64.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/thingset/branch/v0.4/" class="home-link router-link-active"><img src="/thingset/branch/v0.4/favicons/apple-touch-icon.png" alt="ThingSet Protocol Specification" class="logo"> <span class="site-name">ThingSet Protocol Specification</span></a> <div class="links"><div class="search-box can-hide"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="History Menu" class="dropdown-title"><span class="title">History</span> <span class="arrow down"></span></button> <button type="button" aria-label="History Menu" class="mobile-dropdown-title"><span class="title">History</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/thingset/branch/v0.4/" class="nav-link">
  v0.4
</a></li><li class="dropdown-item"><!----> <a href="/thingset/branch/v0.4/v0.3/" class="nav-link">
  v0.3
</a></li><li class="dropdown-item"><!----> <a href="/thingset/branch/v0.4/v0.2/" class="nav-link">
  v0.2
</a></li><li class="dropdown-item"><!----> <a href="/thingset/branch/v0.4/v0.1/" class="nav-link">
  v0.1
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="History Menu" class="dropdown-title"><span class="title">History</span> <span class="arrow down"></span></button> <button type="button" aria-label="History Menu" class="mobile-dropdown-title"><span class="title">History</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/thingset/branch/v0.4/" class="nav-link">
  v0.4
</a></li><li class="dropdown-item"><!----> <a href="/thingset/branch/v0.4/v0.3/" class="nav-link">
  v0.3
</a></li><li class="dropdown-item"><!----> <a href="/thingset/branch/v0.4/v0.2/" class="nav-link">
  v0.2
</a></li><li class="dropdown-item"><!----> <a href="/thingset/branch/v0.4/v0.1/" class="nav-link">
  v0.1
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Why ThingSet?</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/thingset/branch/v0.4/" aria-current="page" class="sidebar-link">Introduction</a></li><li><a href="/thingset/branch/v0.4/1b_existing_solutions.html" class="sidebar-link">Existing Standards</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Application Layer</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/thingset/branch/v0.4/2a_general.html" aria-current="page" class="active sidebar-link">General Concept</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/thingset/branch/v0.4/2a_general.html#message-types" class="sidebar-link">Message Types</a></li><li class="sidebar-sub-header"><a href="/thingset/branch/v0.4/2a_general.html#protocol-modes" class="sidebar-link">Protocol Modes</a></li><li class="sidebar-sub-header"><a href="/thingset/branch/v0.4/2a_general.html#data-structure" class="sidebar-link">Data Structure</a></li><li class="sidebar-sub-header"><a href="/thingset/branch/v0.4/2a_general.html#device-classes" class="sidebar-link">Device Classes</a></li><li class="sidebar-sub-header"><a href="/thingset/branch/v0.4/2a_general.html#function-codes" class="sidebar-link">Function Codes</a></li></ul></li><li><a href="/thingset/branch/v0.4/2b_text_mode.html" class="sidebar-link">Text Mode</a></li><li><a href="/thingset/branch/v0.4/2c_binary_mode.html" class="sidebar-link">Binary Mode</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Lower Layers</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/thingset/branch/v0.4/3a_serial.html" class="sidebar-link">Serial</a></li><li><a href="/thingset/branch/v0.4/3b_can.html" class="sidebar-link">CAN</a></li><li><a href="/thingset/branch/v0.4/3c_lorawan.html" class="sidebar-link">LoRaWAN</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Protocol Mapping</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/thingset/branch/v0.4/4a_http.html" class="sidebar-link">HTTP</a></li><li><a href="/thingset/branch/v0.4/4b_coap.html" class="sidebar-link">CoAP</a></li><li><a href="/thingset/branch/v0.4/4c_mqtt.html" class="sidebar-link">MQTT</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Tools</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/thingset/branch/v0.4/5a_serial.html" class="sidebar-link">Serial</a></li><li><a href="/thingset/branch/v0.4/5b_can.html" class="sidebar-link">CAN bus</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="general-concept"><a href="#general-concept" class="header-anchor">#</a> General Concept</h1> <p>The ThingSet protocol provides a consistent, standardized way to configure, monitor and control ressource-constrained devices via different communication interfaces. It specifies the higher layers (5 to 7) of the <a href="https://en.wikipedia.org/wiki/OSI_model" target="_blank" rel="noopener noreferrer">OSI (Open Systems Interconnection) model<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. The payload data is independent of the underlying lower layer protocol or interface, which can be CAN, USB, LoRa, WiFi, Bluetooth, UART (serial) or similar.</p> <p><img src="/thingset/branch/v0.4/assets/img/osi_layers.67f8a7c8.png" alt="ISO/OSI layer setup"></p> <p>The underlying layers have to ensure encryption, reliable transfer, correct packet order (if messages are packetized) and error-checking of the transferred data.</p> <p>A major feature of the ThingSet protocol is a seamless integration with other application layer protocols such as HTTP, <a href="https://tools.ietf.org/html/rfc7252" target="_blank" rel="noopener noreferrer">CoAP<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and MQTT. Suggestions for implementing gateways to convert between ThingSet messages and HTTP/CoAP/MQTT payload can be found in the Protocol Mapping sections.</p> <h2 id="message-types"><a href="#message-types" class="header-anchor">#</a> Message Types</h2> <p>ThingSet defines three types of messages: Requests, responses and statements.</p> <p>A <strong>request</strong> is sent from one device (client) to a single other device (server). The server is expected to answer with a <strong>response</strong> containing a status code and optional payload.</p> <p>A <strong>statement</strong> is a message that is sent without expecting a response or confirmation. It may be sent to a particular device or broadcast through the network to be received by any interested device (publish-subscribe model).</p> <p>If a device receives a statement, it is considered a proposal to update the values as stated in the message. If all or some of the requested changes are invalid, they are silently ignored, as it is not possible to respond to a statement.</p> <h3 id="request-response-model"><a href="#request-response-model" class="header-anchor">#</a> Request-response model</h3> <p>The communication between two specific devices uses a request-response messaging pattern. A connection can be established either directly (e.g. serial interface, USB, Bluetooth) or via a network or bus with several devices attached (e.g. CAN, Ethernet, WiFi, LoRa). In case of a network, each device has to be uniquely addressable.</p> <p><img src="/thingset/branch/v0.4/assets/img/communication_channels.e239da73.png" alt="Communication Channels"></p> <p>The client would usually be a display, a mobile phone application or a gateway.</p> <p>The data transfer is always synchronous: The client sends a request and waits until it receives a response before it sends another request to the same device.</p> <h3 id="publish-subscribe-model"><a href="#publish-subscribe-model" class="header-anchor">#</a> Publish-subscribe model</h3> <p>Monitoring data is not intended for only a single device, but could be interesting for several devices (e.g. data logger and display). Thus, the monitoring data can be exchanged via a publish-subscribe messaging pattern to increase efficiency and avoid polling.</p> <p>In contrast to MQTT, published messages are directly broadcast and there is no intermediate broker to store the messages. Published messages are not confirmed by recipients, so there is no guarantee if the message was received.</p> <p>This model is mainly used for machine-to-machine (M2M) communication, e.g. to store measurements in a database. One dedicated application is the plug-and-play control of multiple energy sources and sinks in a renewable energy system. The details of the implementation are currently still work-in-progress.</p> <h2 id="protocol-modes"><a href="#protocol-modes" class="header-anchor">#</a> Protocol Modes</h2> <p>Similar to Modbus, the ThingSet protocol supports two different modes: A human-readable text mode and a binary mode.</p> <p>In the text mode, payload data is encoded in JSON format (<a href="https://tools.ietf.org/html/rfc8259" target="_blank" rel="noopener noreferrer">RFC 8259<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>). This mode is recommended when using serial communication interfaces as the low layer protocol, as it can be easily used directly on a terminal.</p> <p>The binary mode uses CBOR (<a href="https://tools.ietf.org/html/rfc7049" target="_blank" rel="noopener noreferrer">RFC 7049<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>) instead of JSON for payload data encoding in order to reduce the protocol overhead for ressource-constrained devices or low bandwith communication via CAN or LoRa.</p> <p>A device may implement both variants of the protocol, but it is also allowed to support only the mode most suitable for the application.</p> <h2 id="data-structure"><a href="#data-structure" class="header-anchor">#</a> Data Structure</h2> <p>All accessible data of a device is <a href="https://en.wikipedia.org/wiki/Tree_(data_structure)" target="_blank" rel="noopener noreferrer">structured as a tree<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. The nodes in the tree structure are called <strong>data objects</strong> and correspond to the JSON object definition.</p> <p>Inner nodes in the structure are used to define the hierarchical structure of the data.</p> <p>Actual data is stored in leaf nodes, called <strong>data items</strong>. The data items can contain any kind of measurements (e.g. temperature), device configuration (e.g. setpoint of a controller) or similar information.</p> <p>Each data object in the tree is identified by a numeric ID and a name. The ID can be chosen by the firmware developer. The name is a short case-sensitive ASCII string containing only alphanumeric characters, dots or underscores without any whitespace characters.</p> <p>The underscore is only used to specify the unit of a data item (also see below). No additional underscores are allowed in the name.</p> <p>A dot is used to identify paths which are used internally by the implementation of the protocol itself (e.g. configuration of publication messages). Other usages of a dot in the data object names is not allowed.</p> <p>The IDs must be unique per device. Except for internal data objects (behind in a path starting with a dot) also the name must be unique.</p> <p>The IDs are used to access data objects in the binary protocol mode for reduced message size. They can also be used in the firmware to define the relations in the data structure. For all interactions with users and in the text-based mode, only the object names and paths are used.</p> <h3 id="reserved-ids"><a href="#reserved-ids" class="header-anchor">#</a> Reserved IDs</h3> <p>The IDs 0x10-0x1F are reserved for special data objects that need to be known in advance. In addition to that, IDs starting from 0x8000 are reserved for control purposes and will be assigned in the future.</p> <p>The following table shows the assigned IDs. Currently unassigned IDs might be defined in a future version of the protocol.</p> <table><thead><tr><th>ID</th> <th>Name</th> <th>Description</th></tr></thead> <tbody><tr><td>0x10</td> <td>Time_s</td> <td>Unix timestamp in seconds since Jan 01, 1970</td></tr> <tr><td>0x17</td> <td>.name</td> <td>Endpoint used by binary protocol to determine names from IDs</td></tr> <tr><td>0x18</td> <td>DataExtURL</td> <td>URL to JSON file containing additional information about exposed data</td></tr> <tr><td>&gt;=0x8000</td> <td>...</td> <td>Control data objects with fixed IDs</td></tr></tbody></table> <p>The IDs up to 0x17 consume only a single byte when encoded as CBOR, which minimizes space consumption for IDs that are used often. The <code>DataExtURL</code> is retrieved only once during startup, so it is acceptable to consume 2 bytes for its ID.</p> <h3 id="example"><a href="#example" class="header-anchor">#</a> Example</h3> <p>For explanation of the protocol, the following simplified data structure of an MPPT charge controller will be used:</p> <div class="language-JSON extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;info&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>                                                       <span class="token comment">// 0x01</span>
        <span class="token property">&quot;DataExtURL&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://files.libre.solar/tsx/cc-v03.json&quot;</span><span class="token punctuation">,</span>  <span class="token comment">// 0x18 (fixed)</span>
        <span class="token property">&quot;DeviceType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;MPPT 1210 HUS&quot;</span><span class="token punctuation">,</span>                              <span class="token comment">// 0x30</span>
        <span class="token property">&quot;DeviceID&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ABC12345&quot;</span>                                      <span class="token comment">// 0x31</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;meas&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>                                                       <span class="token comment">// 0x02</span>
        <span class="token property">&quot;Bat_V&quot;</span><span class="token operator">:</span> <span class="token number">14.2</span><span class="token punctuation">,</span>                                              <span class="token comment">// 0x40</span>
        <span class="token property">&quot;Bat_A&quot;</span><span class="token operator">:</span> <span class="token number">5.13</span><span class="token punctuation">,</span>                                              <span class="token comment">// 0x41</span>
        <span class="token property">&quot;Ambient_degC&quot;</span><span class="token operator">:</span> <span class="token number">22</span>                                          <span class="token comment">// 0x42</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;state&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>                                                      <span class="token comment">// 0x03</span>
        <span class="token property">&quot;ChargerState&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>                                          <span class="token comment">// 0x60</span>
        <span class="token property">&quot;ErrorFlags&quot;</span><span class="token operator">:</span> <span class="token number">0</span>                                             <span class="token comment">// 0x61</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;rec&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>                                                        <span class="token comment">// 0x04</span>
        <span class="token property">&quot;Time_s&quot;</span><span class="token operator">:</span> <span class="token number">460677600</span><span class="token punctuation">,</span>                                        <span class="token comment">// 0x10 (fixed)</span>
        <span class="token property">&quot;BatChgDay_Wh&quot;</span><span class="token operator">:</span> <span class="token number">1984</span><span class="token punctuation">,</span>                                       <span class="token comment">// 0x70</span>
        <span class="token property">&quot;AmbientMax_deg&quot;</span><span class="token operator">:</span> <span class="token number">21.6</span>                                      <span class="token comment">// 0x71</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;input&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>                                                      <span class="token comment">// 0x05</span>
        <span class="token property">&quot;EnableCharging&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>                                      <span class="token comment">// 0x90</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;conf&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>                                                       <span class="token comment">// 0x06</span>
        <span class="token property">&quot;BatCharging_V&quot;</span><span class="token operator">:</span> <span class="token number">14.4</span>                                       <span class="token comment">// 0xA0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;rpc&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>                                                        <span class="token comment">// 0x0E</span>
        <span class="token property">&quot;x-reset&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>                                            <span class="token comment">// 0xE0</span>
        <span class="token property">&quot;x-auth&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Password&quot;</span><span class="token punctuation">]</span>                                      <span class="token comment">// 0xE1</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;dfu&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>                                                        <span class="token comment">// 0x0D</span>
        <span class="token property">&quot;x-write&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Offset_B&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Data&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                            <span class="token comment">// 0xF0</span>
        <span class="token property">&quot;FlashSize_KiB&quot;</span><span class="token operator">:</span> <span class="token number">128</span>                                        <span class="token comment">// 0xF1</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;report&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Time_s&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Bat_V&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Ambient_degC&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                  <span class="token comment">// 0x20</span>
    <span class="token property">&quot;ctrl&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>                                                       <span class="token comment">// 0x0C</span>
        <span class="token property">&quot;bus-voltage&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>                                            <span class="token comment">// 0xDC01</span>
            <span class="token property">&quot;Margin_V&quot;</span><span class="token operator">:</span> <span class="token number">0.7</span><span class="token punctuation">,</span>                                        <span class="token comment">// 0x7000</span>
            <span class="token property">&quot;AbsMax_v&quot;</span><span class="token operator">:</span> <span class="token number">30</span>                                          <span class="token comment">// 0x7001</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;.pub&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>                                                       <span class="token comment">// 0x0F</span>
        <span class="token property">&quot;info&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>                                                   <span class="token comment">// 0x100</span>
            <span class="token property">&quot;OnChange&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>                                        <span class="token comment">// 0x101</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;report&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>                                                 <span class="token comment">// 0x102</span>
            <span class="token property">&quot;Period_s&quot;</span><span class="token operator">:</span> <span class="token number">10</span>                                          <span class="token comment">// 0x103</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;.name&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>                                                      <span class="token comment">// 0x17 (fixed)</span>
        <span class="token property">&quot;1&quot;</span><span class="token operator">:</span> <span class="token string">&quot;.spec&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;2&quot;</span><span class="token operator">:</span> <span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span>
        <span class="token comment">// ...</span>
        <span class="token property">&quot;70&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Bat_V&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The data objects are structured in different groups like <code>info</code> and <code>conf</code> as described below. By convention, data items (leaf nodes) use <a href="https://en.wikipedia.org/wiki/Camel_case" target="_blank" rel="noopener noreferrer">upper camel case<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for their names, inner objects to define a path use lower case names.</p> <p>The <code>rpc</code> group provides functions that can be called. In order to distinguish functions from normal data objects, executable object names are lower case and prefixed with <code>x-</code>.</p> <p>The <code>.pub</code> path is used to configure the automatic publication of messages, so it doesn't hold normal data objects. Such internal nodes are prefixed with a <code>.</code>, similar to hidden files or folders in computer file systems.</p> <p>The data node <code>report</code> in above example is a so-called <strong>subset</strong>, which contains an array pointing at existing data items. It can be used to configure the content of statements for publication if data objects of different groups should be combined in a single message.</p> <h3 id="groups"><a href="#groups" class="header-anchor">#</a> Groups</h3> <p>The following groups for data objects are used for the ThingSet protocol by default:</p> <table><thead><tr><th>Group</th> <th>ID</th> <th>Origin</th> <th>Description</th> <th>Access</th></tr></thead> <tbody><tr><td>info</td> <td>0x01</td> <td>device</td> <td>Static device information (e.g. manufacturer, software version)</td> <td>read</td></tr> <tr><td>meas</td> <td>0x02</td> <td>device</td> <td>Measurement data (changes regularly)</td> <td>read</td></tr> <tr><td>state</td> <td>0x03</td> <td>device</td> <td>Event-based status information</td> <td>read</td></tr> <tr><td>rec</td> <td>0x04</td> <td>device</td> <td>Recorded (history-dependent) data (e.g. min/max values)</td> <td>read + reset</td></tr> <tr><td>input</td> <td>0x05</td> <td>client</td> <td>Input objects (e.g. actuators)</td> <td>read + write</td></tr> <tr><td>conf</td> <td>0x06</td> <td>both</td> <td>Configurable settings, stored in non-volatile memory after change</td> <td>read + write, partly protected</td></tr> <tr><td>cal</td> <td>0x07</td> <td>both</td> <td>Factory-calibrated settings</td> <td>read + write, protected</td></tr> <tr><td>rpc</td> <td>0x0E</td> <td>client</td> <td>Executable functions</td> <td>execute</td></tr> <tr><td>dfu</td> <td>0x0D</td> <td>client</td> <td>Functions and data for device firmware upgrade</td> <td>read + execute</td></tr></tbody></table> <p>The data objects of <code>meas</code>, <code>state</code> and <code>input</code> groups are used for instantaneous data. Changes to <code>input</code> data objects are only stored in RAM, so they get lost after a reset of the device. In contrast to that, <code>conf</code> data is stored in non-volatile memory (e.g. flash or EEPROM) after a change. As non-volatile memory has a limited amount of write cycles, configuration data should not be changed continuously.</p> <p>The <code>rec</code> data group is used for history-dependent data like error memory, energy counters or min/max values of certain measurements. In contrast to data of <code>meas</code> group, recorded data cannot be obtained through measurement after reset, so the current status has to be stored in non-volatile memory on a regular basis. Also the current timestamp <code>Time_s</code> is stored in the <code>rec</code> group, as it is essentially a counter that is incremented each second.</p> <p>Factory calibration data objects are only accessible for the manufacturer after authentication.</p> <p>Excecutable data means that they trigger a function call in the device firmware. Child objects of the executable object can be used internally to define parameters that can be passed to the function.</p> <p>Data object IDs are stored as unsigned integers. The firmware developer should assign the lowest IDs to the most used data objects, as they consume less bytes during transfer (see CBOR representation of unsigned integers).</p> <h3 id="units"><a href="#units" class="header-anchor">#</a> Units</h3> <p>Only <a href="https://en.wikipedia.org/wiki/International_System_of_Units" target="_blank" rel="noopener noreferrer">SI units<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and derived units (e.g. kWh for energy instead of Ws) are allowed.</p> <p>The unit is appended to the data object name using an underscore. In order to keep the data object name very compact, the unit is also used to identify the physical quantity of the value. So instead of &quot;BatteryEnergy_kWh&quot; a short name like &quot;Bat_kWh&quot; is preferred.</p> <p>Some special characters have to be replaced according to the following table in order to be compatible with URIs (see <a href="https://tools.ietf.org/html/rfc3986#section-2.3" target="_blank" rel="noopener noreferrer">RFC 3986, section 2.3<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>):</p> <table><thead><tr><th>Character</th> <th>Replacement</th> <th>Example</th></tr></thead> <tbody><tr><td>°</td> <td>deg</td> <td>&quot;Ambient_degC&quot; for ambient temperature in °C</td></tr> <tr><td>%</td> <td>pct</td> <td>&quot;Humidity_pct&quot; for relative humidity in %</td></tr> <tr><td>/</td> <td>_</td> <td>&quot;Veh_m_s&quot; for vehicle speed in m/s</td></tr> <tr><td>^</td> <td>(omitted)</td> <td>&quot;Surface_m2&quot; for surface area in m^2</td></tr></tbody></table> <h2 id="device-classes"><a href="#device-classes" class="header-anchor">#</a> Device Classes</h2> <p><a href="https://datatracker.ietf.org/doc/html/rfc7228" target="_blank" rel="noopener noreferrer">RFC 7228<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> defines three different classes of constrained devices according to the following table:</p> <table><thead><tr><th>Name</th> <th>data size (e.g., RAM)</th> <th>code size (e.g., Flash)</th></tr></thead> <tbody><tr><td>Class 0, C0</td> <td>&lt;&lt; 10 KiB</td> <td>&lt;&lt; 100 KiB</td></tr> <tr><td>Class 1, C1</td> <td>~ 10 KiB</td> <td>~ 100 KiB</td></tr> <tr><td>Class 2, C2</td> <td>~ 50 KiB</td> <td>~ 250 KiB</td></tr></tbody></table> <p>The ThingSet protocol aims at being suitable for all classes.</p> <p>For class 0 devices and on networks with very low bitrate and payload sizes (CAN, LoRaWAN) it is recommended to use the binary mode with numeric IDs instead of data object names to keep the messages as compact as possible.</p> <p>If the payload size does not have to be optimized to its very minimum, the binary mode can be used with names instead of IDs (see <a href="/thingset/branch/v0.4/2c_binary_mode.html">Binary Mode</a> chapter for more details). The advantage of the binary mode is that no support for floating point numbers for <code>printf</code> is required, which reduces firmware footprint significantly. This mode is suitable for class 0 and class 1 devices.</p> <p>For most class 1 and class 2 devices, floating-point support will not be an issue, so they might also use the text mode for easier direct interactions with humans. Also gateways should typically support the text mode in order to map ThingSet to other higher-level protocols like HTTP and MQTT.</p> <h2 id="function-codes"><a href="#function-codes" class="header-anchor">#</a> Function Codes</h2> <p>The first byte of a ThingSet message is either a text-mode identifier ('?', '=', '!', '+', '-', ':' and '#'), a binary request code or a binary status code. Received data with unknown first byte is ignored, so that other text output (e.g. debug print information) can be used in parallel to the ThingSet protocol on the same serial interface.</p> <h3 id="requests"><a href="#requests" class="header-anchor">#</a> Requests</h3> <p>The protocol supports the typical <a href="https://en.wikipedia.org/wiki/Create,_read,_update_and_delete" target="_blank" rel="noopener noreferrer">CRUD operations<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Request codes match with CoAP to allow transparent mapping between ThingSet and HTTP APIs or CoAP devices.</p> <table><thead><tr><th>Code</th> <th>Text ID</th> <th>Method</th> <th>Description</th></tr></thead> <tbody><tr><td>0x01</td> <td>?</td> <td>GET</td> <td>Retrieve all data from a path</td></tr> <tr><td>0x02</td> <td>+ or !</td> <td>POST</td> <td>Append data to an object or execute a function</td></tr> <tr><td>0x04</td> <td>-</td> <td>DELETE</td> <td>Delete data from an object</td></tr> <tr><td>0x05</td> <td>?</td> <td>FETCH</td> <td>Retrieve a subset of data from a path</td></tr> <tr><td>0x07</td> <td>=</td> <td>iPATCH</td> <td>Update (overwrite) data of a path</td></tr></tbody></table> <p>The CoAP PUT and PATCH methods are not explicitly implemented. PUT is equivalent to an update of all sub-objects of a resource using a PATCH request. PATCH requests for ThingSet are always idempotent, so only the iPATCH request code is supported. The two different text IDs for POST requests are synonyms. It is decided based on the type of the data object if the request is understood as a function call or a request to create a resource.</p> <p>Additional request codes may be introduced in the future. Codes 0x0A, 0x0D and 0x20-0x7F are reserved, as they represent the ASCII characters for readable text including LF and CR.</p> <h3 id="responses"><a href="#responses" class="header-anchor">#</a> Responses</h3> <p>Response messages in binary format are identified by a first byte greater than or equal to 128 (0x80) containing a status code which shows if the request could be handled successfully. For status codes between 0x80 and 0x9F, the response was successful. If the status code is greater than or equal to 0xA0, an error occured.</p> <p>The status codes are again aligned with CoAP response codes, but contain an offset so that there is no interference with ASCII characters (less than 0x80).</p> <table><thead><tr><th>Code</th> <th>CoAP</th> <th>HTTP</th> <th>Description</th> <th>Comment</th></tr></thead> <tbody><tr><td>0x81</td> <td>2.01</td> <td>201</td> <td>Created</td> <td>Answer to POST requests appending data</td></tr> <tr><td>0x82</td> <td>2.02</td> <td>204</td> <td>Deleted</td> <td>Answer to DELETE request</td></tr> <tr><td>0x83</td> <td>2.03</td> <td>200</td> <td>Valid</td> <td>Answer to POST requests to exec objects</td></tr> <tr><td>0x84</td> <td>2.04</td> <td>204</td> <td>Changed</td> <td>Answer to PATCH requests</td></tr> <tr><td>0x85</td> <td>2.05</td> <td>200</td> <td>Content</td> <td>Answer to GET / FETCH requests</td></tr> <tr><td>0xA0</td> <td>4.00</td> <td>400</td> <td>Bad Request</td> <td></td></tr> <tr><td>0xA1</td> <td>4.01</td> <td>401</td> <td>Unauthorized</td> <td>Authentication needed</td></tr> <tr><td>0xA3</td> <td>4.03</td> <td>403</td> <td>Forbidden</td> <td>Trying to write read-only value</td></tr> <tr><td>0xA4</td> <td>4.04</td> <td>404</td> <td>Not Found</td> <td></td></tr> <tr><td>0xA5</td> <td>4.05</td> <td>405</td> <td>Method Not Allowed</td> <td>If e.g. DELETE is not allowed for that object</td></tr> <tr><td>0xA8</td> <td>4.08</td> <td>400</td> <td>Request Entity Incomplete</td> <td></td></tr> <tr><td>0xA9</td> <td>4.09</td> <td>409</td> <td>Conflict</td> <td>Configuration conflicts with other settings</td></tr> <tr><td>0xAD</td> <td>4.13</td> <td>413</td> <td>Request Entity Too Large</td> <td></td></tr> <tr><td>0xAF</td> <td>4.15</td> <td>415</td> <td>Unsupported Content-Format</td> <td>If trying to assign a string to an int</td></tr> <tr><td>0xC0</td> <td>5.00</td> <td>500</td> <td>Internal Server Error</td> <td></td></tr> <tr><td>0xC1</td> <td>5.01</td> <td>501</td> <td>Not Implemented</td> <td></td></tr></tbody></table> <p>The text mode converts the the hexadecimal response code into a string without the 0x prefix. The binary mode uses the code directly as the first byte.</p> <h3 id="statements"><a href="#statements" class="header-anchor">#</a> Statements</h3> <p>Statements are neither requests nor response messages, as they are sent without expecting a confirmation. Below table lists the message specifier in text and binary mode.</p> <table><thead><tr><th>Code</th> <th>Text ID</th> <th>Description</th></tr></thead> <tbody><tr><td>0x1F</td> <td>#</td> <td>Statement message</td></tr></tbody></table> <p>The internal path <code>.pub</code> is used to configure the device to publish certain data items on a regular basis through a defined communication channel (UART, CAN, LoRaWAN, etc.). If implemented in the firmware, the publication interval may be adjustable.</p> <p>By convention, the object names below the <code>.pub</code> define which data object should be published. This can be an entire group like <code>meas</code> or a subset data object that contains a list of references to other data items like <code>report</code> in the above example.</p> <p>If a <code>Period_s</code> data object exists, it can be set to <code>0</code> to disable publication of this message. For event-based publication, a data object <code>OnChange</code> can be specified, which publishes the message only if one of the data objects has changed.</p> <p>More details regarding the ThingSet protocol methods for data access will be explained in the next chapter.</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">8/4/2021, 11:23:12 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/thingset/branch/v0.4/1b_existing_solutions.html" class="prev">
        Existing Standards
      </a></span> <span class="next"><a href="/thingset/branch/v0.4/2b_text_mode.html">
        Text Mode
      </a>
      →
    </span></p></div>  <div class="footer">
    Content provided by <a href="https://libre.solar">Libre Solar</a> under <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode">CC-BY-SA 4.0 License</a> | <a href="https://libre.solar/about/contact/">Contact / Impressum</a></div></main></div><div class="global-ui"></div></div>
    <script src="/thingset/branch/v0.4/assets/js/app.7e1b989c.js" defer></script><script src="/thingset/branch/v0.4/assets/js/2.d1779d51.js" defer></script><script src="/thingset/branch/v0.4/assets/js/3.b5a90050.js" defer></script><script src="/thingset/branch/v0.4/assets/js/9.1ab050b2.js" defer></script>
  </body>
</html>
