<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>General Concept | ThingSet Protocol Specification</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="apple-touch-icon" sizes="180x180" href="/thingset/branch/fix-response-codes/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/thingset/branch/fix-response-codes/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/thingset/branch/fix-response-codes/favicons/favicon-16x16.png">
    <link rel="manifest" href="/thingset/branch/fix-response-codes/favicons/site.webmanifest">
    <link rel="mask-icon" href="/thingset/branch/fix-response-codes/favicons/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="shortcut icon" href="/thingset/branch/fix-response-codes/favicons/favicon.ico">
    <meta name="description" content="The ThingSet protocol provides a consistent, standardized way to configure, monitor and control ressource-constrained devices via different communication interfaces like Serial, LoRa, USB, Bluetooth or CAN.">
    <meta name="msapplication-TileColor" content="#2b5797">
    <meta name="msapplication-config" content="/favicons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    
    <link rel="preload" href="/thingset/branch/fix-response-codes/assets/css/0.styles.ce8b9ea9.css" as="style"><link rel="preload" href="/thingset/branch/fix-response-codes/assets/js/app.cd3fade1.js" as="script"><link rel="preload" href="/thingset/branch/fix-response-codes/assets/js/2.255dc49b.js" as="script"><link rel="preload" href="/thingset/branch/fix-response-codes/assets/js/3.cbbcd511.js" as="script"><link rel="preload" href="/thingset/branch/fix-response-codes/assets/js/9.1d02729e.js" as="script"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/10.7e36c70c.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/11.713ee545.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/12.2e5a3608.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/13.05812ad0.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/14.2ad60313.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/15.639990eb.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/16.0d5bf815.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/17.5f7b45e0.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/18.3a107509.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/19.014c8a63.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/20.dc2afa9a.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/21.40277f37.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/22.10f60380.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/23.68046227.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/24.bac62e78.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/25.de0d830e.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/26.a64e85d1.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/27.4eaf1a67.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/28.ccc37a9e.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/29.87358aac.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/4.c8346c1b.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/5.9ad8f383.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/6.9672f0a7.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/7.7a6c901b.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/8.32893b9d.js">
    <link rel="stylesheet" href="/thingset/branch/fix-response-codes/assets/css/0.styles.ce8b9ea9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/thingset/branch/fix-response-codes/" class="home-link router-link-active"><img src="/thingset/branch/fix-response-codes/favicons/apple-touch-icon.png" alt="ThingSet Protocol Specification" class="logo"> <span class="site-name">ThingSet Protocol Specification</span></a> <div class="links"><div class="search-box can-hide"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="History Menu" class="dropdown-title"><span class="title">History</span> <span class="arrow down"></span></button> <button type="button" aria-label="History Menu" class="mobile-dropdown-title"><span class="title">History</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/thingset/branch/fix-response-codes/" class="nav-link">
  v0.3
</a></li><li class="dropdown-item"><!----> <a href="/thingset/branch/fix-response-codes/v0.2/" class="nav-link">
  v0.2
</a></li><li class="dropdown-item"><!----> <a href="/thingset/branch/fix-response-codes/v0.1/" class="nav-link">
  v0.1
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="History Menu" class="dropdown-title"><span class="title">History</span> <span class="arrow down"></span></button> <button type="button" aria-label="History Menu" class="mobile-dropdown-title"><span class="title">History</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/thingset/branch/fix-response-codes/" class="nav-link">
  v0.3
</a></li><li class="dropdown-item"><!----> <a href="/thingset/branch/fix-response-codes/v0.2/" class="nav-link">
  v0.2
</a></li><li class="dropdown-item"><!----> <a href="/thingset/branch/fix-response-codes/v0.1/" class="nav-link">
  v0.1
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Why ThingSet?</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/thingset/branch/fix-response-codes/" aria-current="page" class="sidebar-link">Introduction</a></li><li><a href="/thingset/branch/fix-response-codes/1b_existing_solutions.html" class="sidebar-link">Existing Standards</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Application Layer</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/thingset/branch/fix-response-codes/2a_general.html" aria-current="page" class="active sidebar-link">General Concept</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/thingset/branch/fix-response-codes/2a_general.html#message-types" class="sidebar-link">Message Types</a></li><li class="sidebar-sub-header"><a href="/thingset/branch/fix-response-codes/2a_general.html#protocol-modes" class="sidebar-link">Protocol Modes</a></li><li class="sidebar-sub-header"><a href="/thingset/branch/fix-response-codes/2a_general.html#data-structure" class="sidebar-link">Data Structure</a></li><li class="sidebar-sub-header"><a href="/thingset/branch/fix-response-codes/2a_general.html#function-codes" class="sidebar-link">Function Codes</a></li></ul></li><li><a href="/thingset/branch/fix-response-codes/2b_text_mode.html" class="sidebar-link">Text Mode</a></li><li><a href="/thingset/branch/fix-response-codes/2c_binary_mode.html" class="sidebar-link">Binary Mode</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Lower Layers</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/thingset/branch/fix-response-codes/3a_serial.html" class="sidebar-link">Serial</a></li><li><a href="/thingset/branch/fix-response-codes/3b_can.html" class="sidebar-link">CAN</a></li><li><a href="/thingset/branch/fix-response-codes/3c_lora.html" class="sidebar-link">LoRa</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Protocol Mapping</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/thingset/branch/fix-response-codes/4a_http.html" class="sidebar-link">HTTP</a></li><li><a href="/thingset/branch/fix-response-codes/4b_coap.html" class="sidebar-link">CoAP</a></li><li><a href="/thingset/branch/fix-response-codes/4c_mqtt.html" class="sidebar-link">MQTT</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="general-concept"><a href="#general-concept" class="header-anchor">#</a> General Concept</h1> <p>The ThingSet protocol provides a consistent, standardized way to configure, monitor and control ressource-constrained devices via different communication interfaces. It specifies the higher layers (5 to 7) of the <a href="https://en.wikipedia.org/wiki/OSI_model" target="_blank" rel="noopener noreferrer">OSI (Open Systems Interconnection) model<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. The payload data is independent of the underlying lower layer protocol or interface, which can be CAN, USB, LoRa, WiFi, Bluetooth, UART (serial) or similar.</p> <p><img src="/thingset/branch/fix-response-codes/assets/img/osi_layers.67f8a7c8.png" alt="ISO/OSI layer setup"></p> <p>The underlying layers have to ensure encryption, reliable transfer, correct packet order (if messages are packetized) and error-checking of the transferred data.</p> <p>A major feature of the ThingSet protocol is a seamless integration with other application layer protocols such as HTTP and <a href="https://tools.ietf.org/html/rfc7252" target="_blank" rel="noopener noreferrer">CoAP<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Suggestions for implementing gateways to convert between ThingSet messages and HTTP/CoAP payload will be added in a future separate chapter.</p> <h2 id="message-types"><a href="#message-types" class="header-anchor">#</a> Message Types</h2> <p>ThingSet defines three types of messages: Requests, responses and publication messages.</p> <h3 id="request-response-or-client-server-model"><a href="#request-response-or-client-server-model" class="header-anchor">#</a> Request/response or client/server model</h3> <p>The communication between two specific devices uses a request/response messaging pattern. A connection can be established either directly (e.g. serial interface, USB, Bluetooth) or via a network or bus with several devices attached (e.g. CAN, Ethernet, WiFi, LoRa). In case of a network, each device/node has to be uniquely addressable.</p> <p><img src="/thingset/branch/fix-response-codes/assets/img/communication_channels.e239da73.png" alt="Communication Channels"></p> <p>The device acts as the server and responds to the requests by a client. The client might be a display, a mobile phone application or a gateway.</p> <p>The data transfer is always synchronous: The client sends a request, waits for the response (status code and requested data), processes the response and possibly starts with additional requests.</p> <h3 id="publication-messages"><a href="#publication-messages" class="header-anchor">#</a> Publication messages</h3> <p>Monitoring data is not intended for only a single device, but could be interesting for several devices (e.g. data logger and display). Thus, the monitoring data can be exchanged via a publish/subscribe messaging pattern.</p> <p>Publication messages are directly broadcast through the network. Unlike in MQTT, there is no intermediate broker to store the messages and published messages are not confirmed by recipients, so there is no guarantee if the message was received.</p> <h2 id="protocol-modes"><a href="#protocol-modes" class="header-anchor">#</a> Protocol Modes</h2> <p>Similar to Modbus, the ThingSet protocol supports two different modes: A human-readable text mode and a binary mode.</p> <p>In the text mode, payload data is encoded in JSON format (<a href="https://tools.ietf.org/html/rfc8259" target="_blank" rel="noopener noreferrer">RFC 8259<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>). This mode is recommended when using serial communication interfaces as the low layer protocol, as it can be easily used directly on a terminal.</p> <p>The binary mode uses the CBOR (<a href="https://tools.ietf.org/html/rfc7049" target="_blank" rel="noopener noreferrer">RFC 7049<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>) instead of JSON for payload data encoding in order to reduce the protocol overhead for ressource-constrained devices or low bandwith communication protocols like CAN and LoRa.</p> <p>A device may implement both variants of the protocol, but it is also allowed to support only the mode most suitable for the application.</p> <h2 id="data-structure"><a href="#data-structure" class="header-anchor">#</a> Data Structure</h2> <p>All accessible data of a device is <a href="https://en.wikipedia.org/wiki/Tree_(data_structure)" target="_blank" rel="noopener noreferrer">structured as a tree<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Internal nodes are used to define paths or endpoints for data access. Actual data is stored in the leaf nodes and can be any kind of measurements (e.g. temperature), device configuration (e.g. setpoint of a controller) or similar information.</p> <p>Each node is identified by a unique node ID and a name. The ID can be chosen by the firmware developer. The name is a short case-sensitive ASCII string containing only alphanumeric characters, an underscore, dots or dashes without any whitespace characters. The underscore is only used to specify the unit of the data (if applicable, also see below). No additional underscore is allowed in the name and it should be unique per device at least for nodes that are used in publication messages.</p> <p>The numeric IDs are used to define the relations between nodes and to directly access data nodes in the binary protocol for reduced message size. For all interactions with users and in the text-based mode, only the node names and paths (consisting of multiple node names) are used.</p> <h3 id="example"><a href="#example" class="header-anchor">#</a> Example</h3> <p>For explanation of the protocol, the following simplified data structure of an MPPT charge controller will be used:</p> <div class="language-JSON extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;info&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;DeviceType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;MPPT 1210 HUS&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;conf&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>                                       <span class="token comment">// data stored in NVM</span>
        <span class="token property">&quot;BatCharging_V&quot;</span><span class="token operator">:</span> <span class="token number">14.4</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;input&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>                                      <span class="token comment">// data stored in RAM</span>
        <span class="token property">&quot;EnableCharging&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;output&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;Bat_V&quot;</span><span class="token operator">:</span> <span class="token number">14.1</span><span class="token punctuation">,</span>
        <span class="token property">&quot;Bat_A&quot;</span><span class="token operator">:</span> <span class="token number">5.13</span><span class="token punctuation">,</span>
        <span class="token property">&quot;Ambient_degC&quot;</span><span class="token operator">:</span> <span class="token number">22</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;rec&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;BatChgDay_Wh&quot;</span><span class="token operator">:</span> <span class="token number">1984</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;exec&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;reset&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>                              <span class="token comment">// void function</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;auth&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Password&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                           <span class="token comment">// function with 1 parameter</span>
    <span class="token property">&quot;pub&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>                                        <span class="token comment">// publication channels</span>
        <span class="token property">&quot;serial&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;Enable&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token property">&quot;Interval&quot;</span><span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
            <span class="token property">&quot;IDs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Bat_V&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Bat_A&quot;</span><span class="token punctuation">]</span>               <span class="token comment">// array of node names</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;can&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;Enable&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token property">&quot;Interval&quot;</span><span class="token operator">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span>
            <span class="token property">&quot;IDs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Bat_V&quot;</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;mqtt&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;Enable&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token property">&quot;Interval&quot;</span><span class="token operator">:</span> <span class="token number">3600</span><span class="token punctuation">,</span>
            <span class="token property">&quot;Topic&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chargers/device-id/pub&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;IDs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Bat_V&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Bat_A&quot;</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;sub&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>                                        <span class="token comment">// subscription channels</span>
        <span class="token property">&quot;mqtt&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>                                   <span class="token comment">// may have callback attached</span>
            <span class="token property">&quot;Topic&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chargers/device-id/sub&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;IDs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;EnableCharging&quot;</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The data nodes are structured in the main different categories info, conf, input, output and rec. By convention, data node names use <a href="https://en.wikipedia.org/wiki/Camel_case" target="_blank" rel="noopener noreferrer">upper camel case<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, inner nodes nodes use lower case names.</p> <p>The exec category is special, as it provides functions that can be called. In order to distinguish functions from a normal data nodes, executable node names are lower case.</p> <p>The pub node is used to configure different types of publication messages, so it doesn't hold normal data nodes.</p> <h3 id="categories"><a href="#categories" class="header-anchor">#</a> Categories</h3> <p>The following categories for data nodes are used for the ThingSet protocol by default:</p> <table><thead><tr><th>Category</th> <th>Description</th> <th>Access</th></tr></thead> <tbody><tr><td>info</td> <td>Device information (e.g. manufacturer, software version)</td> <td>read access</td></tr> <tr><td>conf</td> <td>Configurable settings, stored in non-volatile memory after change</td> <td>read/write access, expert settings may be password-protected</td></tr> <tr><td>input</td> <td>Input nodes (e.g. actuators)</td> <td>write access</td></tr> <tr><td>output</td> <td>Output nodes (e.g. sensor data)</td> <td>read access</td></tr> <tr><td>rec</td> <td>Recorded (history-dependent) data (e.g. min/max values)</td> <td>read access, restricted write access to reset</td></tr> <tr><td>cal</td> <td>Factory-calibrated settings</td> <td>read/write access, protected</td></tr> <tr><td>exec</td> <td>Executable functions</td> <td>partly access restricted</td></tr></tbody></table> <p>The nodes of input and output categories are used for instantaneous data. Changes to input nodes are only stored in RAM, so they get lost after a reset of the device. In contrast to that, conf data is stored in non-volatile memory (e.g. flash or EEPROM) after a change. As non-volatile memory has a limited amount of write cycles, configuration data should not be changed continously.</p> <p>The recorded data category is used for history-dependent data like error memory, energy counters or min/max values of certain measurements. In contrast to data of output category, recorded data cannot be obtained through measurement after reset, so the current state has to be stored in non-volatile memory on a regular basis.</p> <p>Factory calibration data nodes are only accessible for the manufacturer after authentication.</p> <p>Excecutable data means that they trigger a function call in the device firmware. Child nodes of the executable node can be used to define parameters that can be passed to the function.</p> <p>Data node IDs are stored as unsigned integers. The firmware developer should assign the lowest IDs to the most used data objects, as they consume less bytes during transfer (see CBOR representation of unsigned integers).</p> <h3 id="units"><a href="#units" class="header-anchor">#</a> Units</h3> <p>Only <a href="https://en.wikipedia.org/wiki/International_System_of_Units" target="_blank" rel="noopener noreferrer">SI units<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and derived units (e.g. kWh for energy instead of Ws) are allowed.</p> <p>The unit is appended to the data object name using an underscore. In order to keep the data object name very compact, the unit is also used to identify the physical quantity of the value. So instead of &quot;BatteryEnergy_kWh&quot; a short name like &quot;Bat_kWh&quot; is preferred.</p> <p>Some special characters have to be replaced according to the following table in order to be compatible with URIs (see <a href="https://tools.ietf.org/html/rfc3986#section-2.3" target="_blank" rel="noopener noreferrer">RFC 3986, section 2.3<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>):</p> <table><thead><tr><th>Character</th> <th>Replacement</th> <th>Example</th></tr></thead> <tbody><tr><td>°</td> <td>deg</td> <td>&quot;Ambient_degC&quot; for ambient temperature in °C</td></tr> <tr><td>%</td> <td>pct</td> <td>&quot;Humidity_pct&quot; for relative humidity in %</td></tr> <tr><td>/</td> <td>-</td> <td>&quot;Veh_m-s&quot; for vehicle speed in m/s</td></tr> <tr><td>^</td> <td>(omitted)</td> <td>&quot;Surface_m2&quot; for surface area in m^2</td></tr></tbody></table> <h2 id="function-codes"><a href="#function-codes" class="header-anchor">#</a> Function Codes</h2> <p>The first byte of a ThingSet message is either a text-mode identifier ('?', '=', '!', '+', '-', ':' and '#'), a binary request code or a binary status code. Received data with unknown first byte is ignored, so that other text output (e.g. debug print information) can be used in parallel to the ThingSet protocol on the same serial interface.</p> <h3 id="requests"><a href="#requests" class="header-anchor">#</a> Requests</h3> <p>The protocol supports the typical <a href="https://en.wikipedia.org/wiki/Create,_read,_update_and_delete" target="_blank" rel="noopener noreferrer">CRUD operations<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Request codes match with CoAP to allow transparent translation and routing between ThingSet and HTTP APIs or CoAP devices.</p> <table><thead><tr><th>Code</th> <th>Text ID</th> <th>Method</th> <th>Description</th></tr></thead> <tbody><tr><td>0x01</td> <td>?</td> <td>GET</td> <td>Retrieve all data from a node</td></tr> <tr><td>0x02</td> <td>+ or !</td> <td>POST</td> <td>Append data to a node or execute a function</td></tr> <tr><td>0x04</td> <td>-</td> <td>DELETE</td> <td>Delete data from a node</td></tr> <tr><td>0x05</td> <td>?</td> <td>FETCH</td> <td>Retrieve a subset of data from a node</td></tr> <tr><td>0x07</td> <td>=</td> <td>iPATCH</td> <td>Update (overwrite) data of a node</td></tr></tbody></table> <p>The CoAP PUT and PATCH methods are not explicitly implemented. PUT is equivalent to an update of all sub-nodes of a resource using a PATCH request. PATCH requests for ThingSet are always idempotent, so only the iPATCH request code is supported. The two different text IDs for POST requests are synonyms. It is decided based on the type of the node if the request is understood as a function call or a request to create a resource.</p> <p>Additional request codes may be introduced in the future. Codes 0x0A, 0x0D and 0x20-0x7F are reserved, as they represent the ASCII characters for readable text including LF and CR.</p> <h3 id="responses"><a href="#responses" class="header-anchor">#</a> Responses</h3> <p>Response messages in binary format are identified by a first byte greater than or equal to 128 (0x80) containing a status code which shows if the request could be handled successfully. For status codes between 0x80 and 0x9F, the response was successful. If the status code is greater than or equal to 0xA0, an error occured.</p> <p>The status codes are again aligned with CoAP response codes, but contain an offset so that there is no interference with ASCII characters (less than 0x80).</p> <table><thead><tr><th>Code</th> <th>CoAP</th> <th>HTTP</th> <th>Description</th> <th>Comment</th></tr></thead> <tbody><tr><td>0x81</td> <td>2.01</td> <td>201</td> <td>Created</td> <td>Answer to POST requests appending data</td></tr> <tr><td>0x82</td> <td>2.02</td> <td>204</td> <td>Deleted</td> <td>Answer to DELETE request</td></tr> <tr><td>0x83</td> <td>2.03</td> <td>200</td> <td>Valid</td> <td>Answer to POST requests to exec nodes</td></tr> <tr><td>0x84</td> <td>2.04</td> <td>204</td> <td>Changed</td> <td>Answer to PATCH requests</td></tr> <tr><td>0x85</td> <td>2.05</td> <td>200</td> <td>Content</td> <td>Answer to GET / FETCH requests</td></tr> <tr><td>0xA0</td> <td>4.00</td> <td>400</td> <td>Bad Request</td> <td></td></tr> <tr><td>0xA1</td> <td>4.01</td> <td>401</td> <td>Unauthorized</td> <td>Authentication needed</td></tr> <tr><td>0xA3</td> <td>4.03</td> <td>403</td> <td>Forbidden</td> <td>Trying to write read-only value</td></tr> <tr><td>0xA4</td> <td>4.04</td> <td>404</td> <td>Not Found</td> <td></td></tr> <tr><td>0xA5</td> <td>4.05</td> <td>405</td> <td>Method Not Allowed</td> <td>If e.g. DELETE is not allowed for that node</td></tr> <tr><td>0xA8</td> <td>4.08</td> <td>400</td> <td>Request Entity Incomplete</td> <td></td></tr> <tr><td>0xA9</td> <td>4.09</td> <td>409</td> <td>Conflict</td> <td>Configuration conflicts with other settings</td></tr> <tr><td>0xAD</td> <td>4.13</td> <td>413</td> <td>Request Entity Too Large</td> <td></td></tr> <tr><td>0xAF</td> <td>4.15</td> <td>415</td> <td>Unsupported Content-Format</td> <td>If trying to assign a string to an int</td></tr> <tr><td>0xC0</td> <td>5.00</td> <td>500</td> <td>Internal Server Error</td> <td></td></tr> <tr><td>0xC1</td> <td>5.01</td> <td>501</td> <td>Not Implemented</td> <td></td></tr></tbody></table> <p>The text mode converts the the hexadecimal response code into a string without the 0x prefix. The binary mode uses the code directly as the first byte.</p> <h3 id="publication-messages-2"><a href="#publication-messages-2" class="header-anchor">#</a> Publication messages</h3> <p>Publication messages are neither requests nor response messages, as they are sent without expecting a confirmation. Below table lists the message specifier in text and binary mode.</p> <table><thead><tr><th>Code</th> <th>Text ID</th> <th>Description</th></tr></thead> <tbody><tr><td>0x1F</td> <td>#</td> <td>Publication message</td></tr></tbody></table> <p>More details regarding the ThingSet protocol methods for data access will be explained in the next chapter.</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/20/2020, 3:29:07 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/thingset/branch/fix-response-codes/1b_existing_solutions.html" class="prev">
        Existing Standards
      </a></span> <span class="next"><a href="/thingset/branch/fix-response-codes/2b_text_mode.html">
        Text Mode
      </a>
      →
    </span></p></div>  <div class="footer">
    Content provided by <a href="https://libre.solar">Libre Solar</a> under <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode">CC-BY-SA 4.0 License</a> | <a href="https://libre.solar/about/contact/">Contact / Impressum</a></div></main></div><div class="global-ui"></div></div>
    <script src="/thingset/branch/fix-response-codes/assets/js/app.cd3fade1.js" defer></script><script src="/thingset/branch/fix-response-codes/assets/js/2.255dc49b.js" defer></script><script src="/thingset/branch/fix-response-codes/assets/js/3.cbbcd511.js" defer></script><script src="/thingset/branch/fix-response-codes/assets/js/9.1d02729e.js" defer></script>
  </body>
</html>
